$(document).ready(function(){var t=0;$(".variant").click(function(t){t.preventDefault(),$(this).addClass("active").siblings().removeClass("active");var a=$(this).children("a").attr("data-option-variant"),e=$(this).children("a").attr("data-option-price");$("input[name=variant]").val(a),$("input[name=price]").val(e)}),$(".input-qty").focus(function(){t=$(this).val()}),$(".input-qty").change(function(){var a=$(this).attr("id"),e=$(this).attr("data-variant"),i=$(this).val(),n=$(this).attr("max"),r=$("#input-csrf").val();if(parseInt(i)>parseInt(n))return $('[data-variant="'+e+'"]').val(t),$("#stock-error").html(parseInt(n)),$(".alert-box").show(),!1;$.post("cart",{id:a,action:"add",quantity:i,csrf:r}).done(function(t){location.reload(!0)})}),$(".close").click(function(t){t.preventDefault(),$(".alert-box").hide()}),$("#add-cart").click(function(t){t.preventDefault(),$(this).html("adding..."),$(this).attr("disabled","disabled"),sessionStorage.setItem("cart","true");var a=$("[name=uri]").val(),e=$("[name=variant]").val(),i=$("[name=csrf]").val();$.post("cart",{uri:a,variant:e,action:"add",csrf:i}).done(function(t){document.location.replace("cart")})});var a=StripeCheckout.configure({key:$("#checkout-key").val(),image:"../assets/images/logo.png",locale:"auto",token:function(t,a){$(".loading").show();var e=$("#input-csrf").val(),i=[];$(".input-qty:visible").each(function(t,a){var e={id:a.id,sku:a.getAttribute("data-sku"),quantity:a.value,price:a.getAttribute("data-amount"),name:a.getAttribute("data-name"),variant:a.getAttribute("data-variant")};i.push(e)});var n=parseInt($("#checkout-total").val());$.post("order",{token:JSON.stringify(t),args:JSON.stringify(a),csrf:e,items:JSON.stringify(i),total:n}).done(function(t){document.location.replace("order")})}});document.getElementById("checkoutButton").addEventListener("click",function(t){a.open({name:"the Invisible Cities",description:$("#checkout-content").val(),zipCode:!0,currency:"CAD",shippingAddress:!0,billingAddress:!0,amount:parseInt($("#checkout-total").val())}),t.preventDefault()}),window.addEventListener("popstate",function(){a.close()}),$("#terms").click(function(t){t.preventDefault(),$("#term-details").toggle()}),paypal.Button.render({env:"sandbox",client:{sandbox:"ASO_SHn9QO_q19onBL4mniATSkbBCcj6IQGYCLeOaBytBPHoUmjyWAFjq6osEy41PagHqW3pBmvE2q2e",production:$("#checkout-pp-key").val()},commit:!0,style:{color:"silver",size:"responsive",shape:"rect",tagline:"false"},payment:function(t,a){return a.payment.create({payment:{transactions:[{amount:{total:parseInt($("#checkout-total").val())/100,currency:"CAD"}}]}})},onAuthorize:function(t,a){return a.payment.execute().then(function(t){var a=$("#input-csrf").val(),e=[];$(".input-qty:visible").each(function(t,a){var i={id:a.id,sku:a.getAttribute("data-sku"),quantity:a.value,price:a.getAttribute("data-amount"),name:a.getAttribute("data-name"),variant:a.getAttribute("data-variant")};e.push(i)});var i=parseInt($("#checkout-total").val()),n={},r={};n.shipping_name=t.payer.payer_info.shipping_address.recipient_name,n.shipping_address_line1=t.payer.payer_info.shipping_address.line1,n.shipping_address_city=t.payer.payer_info.shipping_address.city,n.shipping_address_country=t.payer.payer_info.shipping_address.country_code,n.shipping_address_zip=t.payer.payer_info.shipping_address.postal_code,n.shipping_address_state=t.payer.payer_info.shipping_address.state,n.billing_name=t.payer.payer_info.shipping_address.recipient_name,n.billing_address_line1=t.payer.payer_info.shipping_address.line1,n.billing_address_zip=t.payer.payer_info.shipping_address.postal_code,r.email=t.payer.payer_info.email,r.id=t.id,$.post("order",{token:JSON.stringify(r),args:JSON.stringify(n),csrf:a,items:JSON.stringify(e),total:i}).done(function(t){document.location.replace("order")})})}},"#paypal-button-container")});