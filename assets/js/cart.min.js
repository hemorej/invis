var app=new Vue({el:"#cart",data:{inCart:!0,inShipping:!1,inCheckout:!1,discount:null,total:0,currencies:null,disableDiscount:!1,stripe:null,name:null,email:null,line1:null,line2:null,city:null,province:null,postcode:null,country:null,showTerms:!1,error:!1,leftInStock:1,step:"1. cart",orderWaiting:!1},mounted(){this.country=this.$refs.userLocation.value,this.total=parseInt(this.$refs.total.value),this.currencies=this.$refs.currencies.value},computed:{shippingIncomplete:function(){return this.isEmpty(this.name)||this.isEmpty(this.email)||this.isEmpty(this.line1)||this.isEmpty(this.city)||this.isEmpty(this.province)||this.isEmpty(this.postcode)||this.isEmpty(this.country)||!this.validEmail(this.email)}},methods:{applyDiscount:function(){this.orderWaiting=!0,axios.post("/discount",{discount:this.discount,csrf:this.$refs.discountCSRF.value}).then(t=>{0!=parseInt(t.data.total)&&(this.total=t.data.total,this.currencies=t.data.currencies,this.discount=t.data.discountAmount,this.disableDiscount=!0,this.$refs.checkoutSessionID.value=t.data.checkoutSessionId,this.$refs.checkoutTotal.value=t.data.total),this.orderWaiting=!1})},showShipping:function(){this.inCart=!1,this.inShipping=!0,this.inCheckout=!1,this.step="1. cart   2. shipping address"},showCheckout:function(){this.inCart=!1,this.inCheckout=!0,this.step="1. cart   2. shipping address   3. payment",this.stripe=Stripe(this.$refs.checkoutKey.value),axios.post("/address",{name:this.name,email:this.email,line1:this.line1,line2:this.line2,city:this.city,province:this.province,postcode:this.postcode,country:this.country,csrf:this.$refs.checkoutCSRF.value}).then(t=>{this.$refs.checkoutSessionID.value=t.data.checkoutSessionId})},initPaypal:function(){if(null!==document.getElementById("paypal-button-container")){var t=this;paypal.Buttons({env:this.$refs.ppEnv.value,client:{sandbox:this.$refs.checkoutPPKey.value,production:this.$refs.checkoutPPKey.value},commit:!0,style:{layout:"horizontal",color:"silver",size:"responsive",shape:"rect",tagline:"false"},createOrder:function(e,i){return t.orderWaiting=!0,i.order.create({purchase_units:[{amount:{value:parseInt(t.$refs.checkoutTotal.value)}}]})}.bind(t),onApprove:function(e,i){return i.order.capture().then(function(i){var s=t.$refs.ppCsrf.value,n=e.orderID;axios.post("/order/success/paypal",{token:n,csrf:s}).then(function(t){document.location.replace("/prints/order")})})}.bind(t),onCancel:function(e){t.orderWaiting=!1}.bind(t)}).render("#paypal-button-container")}},redirectStripe:function(){this.stripe.redirectToCheckout({sessionId:this.$refs.checkoutSessionID.value}).then(function(t){alert(t.error.message)})},updateCart:function(t){var e=t.target.id,i=(t.target.getAttribute("data-variant"),t.target.value),s=t.target.getAttribute("max");if(parseInt(i)>parseInt(s))return t.target.value=s,this.leftInStock=s,this.error=!0,!1;axios.post("/prints/cart",{id:e,action:"add",quantity:i,csrf:this.$refs.inputCsrf.value}).then(function(t){location.reload(!0)})},validEmail:function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},isEmpty:function(t){return!t||/^\s*$/.test(t)}}});
